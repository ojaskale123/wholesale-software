<!DOCTYPE html>
<html>
<head>
  <title>Worker - Sell</title>
  <style>
    body { font-family: Arial; background:#f4f6f8; margin:0; }
    header { background:#203a43; color:white; padding:15px 20px; }
    .container { padding:20px; }

    .item {
      background:white;
      padding:12px;
      border-radius:8px;
      margin-bottom:10px;
      box-shadow:0 3px 8px rgba(0,0,0,0.15);
    }

    button {
      padding:6px 10px;
      cursor:pointer;
    }
  </style>
</head>
<body>

<header>
  <h2>Worker – Sell</h2>
</header>

<div class="container">
  <h3>Products</h3>
  <div id="products"></div>

  <h3>Cart</h3>
  <div id="cart"></div>
  <b>Total: ₹<span id="total">0</span></b><br><br>
  <button onclick="confirmSell()">Confirm Sell</button>
</div>

<script>
  let products = JSON.parse(localStorage.getItem("products")) || [];
  let cart = [];

  function renderProducts() {
    const div = document.getElementById("products");
    div.innerHTML = "";

    products.forEach(p => {
      div.innerHTML += `
        <div class="item">
          ${p.name}<br>
          ₹${p.sellPrice} | Qty: ${p.quantity}
          <br>
          <button onclick="add(${p.id})">+</button>
        </div>
      `;
    });
  }

  function add(id) {
    const p = products.find(x => x.id === id);
    if (!p || p.quantity <= 0) {
      alert("Out of stock"); return;
    }

    p.quantity -= 1;

    const c = cart.find(x => x.id === id);
    if (c) c.qty += 1;
    else cart.push({ id, name:p.name, price:p.sellPrice, qty:1 });

    renderCart();
    renderProducts();
  }

  function renderCart() {
    let total = 0;
    const div = document.getElementById("cart");
    div.innerHTML = "";

    cart.forEach(c => {
      total += c.qty * c.price;
      div.innerHTML += `<div>${c.name} × ${c.qty}</div>`;
    });

    document.getElementById("total").innerText = total;
  }

  function confirmSell() {
    if (cart.length === 0) {
      alert("Cart empty"); return;
    }

    localStorage.setItem("products", JSON.stringify(products));

    const sales = JSON.parse(localStorage.getItem("sales")) || [];
    sales.push({
      id: Date.now(),
      date: new Date().toLocaleString(),
      items: cart,
      total: Number(document.getElementById("total").innerText)
    });

    localStorage.setItem("sales", JSON.stringify(sales));

    alert("Sale completed");
    cart = [];
    renderCart();
    renderProducts();
  }

  renderProducts();
</script>

</body>
</html>
