<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Track Repair Status</title>

<style>
:root {
  --bg:#0f172a;
  --card-bg:rgba(30,41,59,.85);
  --border:rgba(148,163,184,.22);
  --text:#e2e8f0;
  --text-muted:#94a3b8;
  --accent:#3b82f6;
  --success:#10b981;
  --warning:#f59e0b;
  --purple:#8b5cf6;
  --radius:16px;
  --shadow:0 12px 32px rgba(0,0,0,.4);
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:system-ui;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
}

.top-header{
  background:linear-gradient(135deg,#1e293b,#0f172a);
  border-bottom:1px solid var(--border);
  padding:1.4rem;
  text-align:center;
}

.top-header h2{
  font-size:1.55rem;
  background:linear-gradient(90deg,#93c5fd,#c7d2fe);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

#info{
  max-width:600px;
  margin:4rem auto;
  padding:0 1.5rem;
}

.status-card{
  background:var(--card-bg);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:2.5rem 2rem;
  box-shadow:var(--shadow);
  text-align:center;
}

.status-card h3{
  font-size:1.8rem;
  margin-bottom:1.5rem;
}

.detail{
  font-size:1.1rem;
  margin:1rem 0;
  color:var(--text-muted);
}

.detail strong{color:var(--text)}

.status-badge{
  display:inline-block;
  margin:1rem 0;
  padding:.6rem 1.5rem;
  border-radius:2rem;
  font-weight:700;
  color:white;
}

.status-OPEN,
.status-COLLECTED{background:var(--warning)}
.status-IN_PROGRESS{background:var(--accent)}
.status-DONE_NOT_DELIVERED{background:var(--purple)}
.status-DONE_DELIVERED{background:var(--success)}

.loading{
  text-align:center;
  padding:4rem;
  color:var(--text-muted);
}
</style>
</head>

<body>

<header class="top-header">
<h2>Repair Status</h2>
</header>

<div id="info" class="loading">Loading repair details...</div>

<script type="module">
import { db } from "./js/firebase.js";
import { doc, getDoc } from 
"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const params = new URLSearchParams(location.search);
const jobId = params.get("jobId");

const container = document.getElementById("info");

if(!jobId){
  container.innerHTML = `
    <div class="status-card">
      <h3>Invalid Link</h3>
      <p class="detail">Tracking ID missing.</p>
    </div>
  `;
}else{
  try{
    const jobRef = doc(db,"jobs",jobId);
    const snap = await getDoc(jobRef);

    if(!snap.exists()){
      container.innerHTML = `
        <div class="status-card">
          <h3>Job Not Found</h3>
          <p class="detail">
            Invalid or expired tracking link.<br>
            Please contact the shop.
          </p>
        </div>
      `;
    }else{
      const job = snap.data();
      const statusClass = "status-" + job.status;

      container.innerHTML = `
        <div class="status-card">
          <h3>${job.device || "Repair Item"}</h3>

          <div class="detail">
            <strong>Status:</strong><br>
            <span class="status-badge ${statusClass}">
              ${job.status.replaceAll("_"," ")}
            </span>
          </div>

          <div class="detail">
            <strong>Expected Cost:</strong>
            ₹${job.expectedCost || "—"}
          </div>

          ${job.customerName ? `
            <div class="detail">
              <strong>Customer:</strong>
              ${job.customerName}
            </div>
          ` : ""}

          ${job.issue ? `
            <div class="detail">
              <strong>Reported Issue:</strong><br>
              ${job.issue}
            </div>
          ` : ""}
        </div>
      `;
    }

  }catch(err){
    container.innerHTML = `
      <div class="status-card">
        <h3>Error</h3>
        <p class="detail">Unable to load repair details.</p>
      </div>
    `;
  }
}
</script>

</body>
</html>
