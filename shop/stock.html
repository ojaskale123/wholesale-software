<!DOCTYPE html>
<html>
<head>
  <title>Stock</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .container { padding: 20px; }
    .header {
      background: linear-gradient(90deg,#0f2027,#203a43,#2c5364);
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
      gap: 15px;
    }
    .card {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      cursor: pointer;
    }
    .add-box input, .add-box select, .add-box textarea {
      width: 100%;
      margin-top: 6px;
      padding: 6px;
      font-size: 14px;
    }
    .add-btn {
      margin-top: 10px;
      width: 100%;
      padding: 12px;
      background: #203a43;
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div class="container">
  <div class="header">
    <h2>Stock Management</h2>
  </div>

  <!-- CATEGORY CARDS -->
  <div class="card-grid">
    <div class="card">üß© Spare Parts</div>
    <div class="card">üì± Electronics</div>
    <div class="card">üîã Batteries</div>
    <div class="card">‚ôªÔ∏è Second-Hand Phones</div>
  </div>

  <br>

  <!-- ADD STOCK (OWNER + SHOPKEEPER ONLY) -->
  <div class="add-box" id="addBox">
    <h3>Add Product</h3>
    <input id="name" placeholder="Product Name">
    <input id="barcode" placeholder="Barcode / Product ID">
    <select id="category">
      <option>Spare Parts</option>
      <option>Electronics</option>
      <option>Batteries</option>
      <option>Second-Hand Phones</option>
    </select>
    <input id="retail" placeholder="Retail Price">
    <input id="sell" placeholder="Sell Price">
    <input id="qty" placeholder="Quantity">
    <textarea id="location" placeholder="Location (Wall / Shelf / Box)"></textarea>
    <button class="add-btn" onclick="addStock()">ADD PRODUCT</button>
  </div>

  <hr>
  <ul id="list"></ul>
</div>

<script type="module">
  import { requireAuth } from "../auth/guard.js";
  import { DB, saveDB } from "../db/fakeDB.js";
  import { logAction } from "../core/audit.js";

  const user = requireAuth(["OWNER","SHOPKEEPER","WORKER"]);

  // hide add stock for worker
  if (user.role === "WORKER") {
    document.getElementById("addBox").style.display = "none";
  }

  window.addStock = () => {
    if (user.role === "WORKER") return alert("Not allowed");

    DB.products.push({
      id: Date.now(),
      shopId: user.shopId,
      name: name.value,
      barcode: barcode.value,
      category: category.value,
      retailPrice: Number(retail.value),
      sellPrice: Number(sell.value),
      quantity: Number(qty.value),
      location: location.value,
      createdAt: new Date().toISOString()
    });

    saveDB();
    logAction(`Added stock ${name.value}`);
    render();
  };

  function render() {
    list.innerHTML = "";
    DB.products
      .filter(p => p.shopId === user.shopId)
      .forEach(p => {
        const li = document.createElement("li");
        li.textContent =
          `${p.name} | ${p.category} | Qty:${p.quantity} | ${p.barcode}`;
        list.appendChild(li);
      });
  }

  render();
</script>

</body>
</html>
